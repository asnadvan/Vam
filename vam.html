document.getElementById("saveDraft").addEventListener("click", ()=>{
      const form = new FormData(document.getElementById("loanForm"));
      const data = {};
      form.forEach((v,k)=> data[k]=v);
      localStorage.setItem("loanDraft", JSON.stringify(data));
      toast("پیش‌نویس ذخیره شد.", true);
    });

    // اعتبارسنجی و ارسال ساختگی
    document.getElementById("loanForm").addEventListener("submit", (e)=>{
      e.preventDefault();
      let ok = true;

      const checks = [
        {id:"fullName", valid: v=> v.trim().length>1},
        {id:"nid", valid: v=> /^\d{10}$/.test(v)},
        {id:"phone", valid: v=> /^09\d{9}$/.test(v)},
        {id:"amount", valid: v=> /^\d{5,}$/.test(v)}, // حداقل ۵ رقم
        {id:"income", valid: v=> /^\d{5,}$/.test(v)},
        {id:"term", valid: v=> !!v}
      ];

      checks.forEach(({id,valid})=>{
        const val = document.getElementById(id).value;
        const isValid = valid(val);
        showError(id, !isValid);
        if(!isValid) ok=false;
      });

      if(!ok){ toast("لطفاً خطاهای فرم را برطرف کنید."); return; }

      // شبیه‌سازی ارسال
      const payload = Object.fromEntries(new FormData(e.target).entries());
      console.log("SUBMIT", payload); // برای تست
      localStorage.removeItem("loanDraft");
      toast("درخواست شما با موفقیت ثبت شد ✅", true);

      // در پروژه واقعی اینجا fetch بزنید:
      // fetch('/api/loan', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)})
    });

    // اگر کاربر دارک‌مود سیستم را اجباری کرده بود و مرورگر «تحمیلِ تم تیره» انجام می‌دهد،
    // باز هم به‌خاطر رنگ‌های تعریف‌شده خوانایی حفظ می‌شود.
  </script>
</body>
</html>
