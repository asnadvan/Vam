<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>درخواست وام</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --text:#0f172a;
      --muted:#64748b;
      --surface:#ffffff;
      --primary:#0ea5e9;
      --primary-600:#0284c7;
      --ring:rgba(14,165,233,.35);
      --error:#ef4444;
      --ok:#10b981;
      --border:#e2e8f0;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1220;
        --text:#e5e7eb;
        --muted:#94a3b8;
        --surface:#0f172a;
        --primary:#38bdf8;
        --primary-600:#0891b2;
        --ring:rgba(56,189,248,.35);
        --border:#1f2a37;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,Inter,Verdana,"Noto Naskh Arabic","Noto Sans Arabic","IRANSans","Vazirmatn",Tahoma,sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      line-height:1.6;
    }
    .wrap{max-width:780px;margin:auto;padding:24px}
    .card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:20px;
      padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.06);
    }
    h1{margin:0 0 12px;font-size:22px}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}
    form{display:grid;gap:14px}
    .row{display:grid;gap:14px}
    @media(min-width:640px){ .row{grid-template-columns:1fr 1fr} }
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input,select,textarea{
      width:100%;
      padding:12px 14px;
      background:transparent;
      border:1px solid var(--border);
      border-radius:12px;
      color:var(--text);
      outline:none;
      text-align:right;
      transition:border .15s, box-shadow .15s, background .15s;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 4px var(--ring);
    }
    .hint{font-size:12px;color:var(--muted)}
    .error{font-size:12px;color:var(--error);display:none}
    .actions{display:flex;gap:10px;justify-content:flex-start;margin-top:6px;flex-wrap:wrap}
    button{
      border:0;border-radius:12px;padding:12px 18px;cursor:pointer;
      background:var(--primary);color:#fff;font-weight:600
    }
    button:hover{background:var(--primary-600)}
    .ghost{background:transparent;color:var(--primary);border:1px solid var(--primary)}
    .toast{
      position:fixed;inset-inline-start:16px;bottom:16px;
      background:var(--surface);border:1px solid var(--border);border-radius:14px;
      padding:12px 14px;box-shadow:0 10px 30px rgba(0,0,0,.15);display:none
    }
    .toast.ok{border-color:rgba(16,185,129,.35)}
    .required::after{content:" *";color:var(--error)}
    .divider{height:1px;background:var(--border);margin:6px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>درخواست وام</h1>
      <p class="lead">لطفاً فرم زیر را با دقت پر کنید. فیلدهای ستاره‌دار اجباری هستند.</p>

      <form id="loanForm" novalidate>
        <div class="row">
          <div>
            <label class="required" for="fullName">نام و نام‌خانوادگی</label>
            <input id="fullName" name="fullName" autocomplete="name" required />
            <div class="error" data-for="fullName">نام الزامی است.</div>
          </div>
          <div>
            <label class="required" for="nid">کد ملی (۱۰ رقم)</label>
            <input id="nid" name="nid" inputmode="numeric" pattern="^\d{10}$" required />
            <div class="error" data-for="nid">کد ملی باید ۱۰ رقم باشد.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label class="required" for="phone">شماره موبایل</label>
            <input id="phone" name="phone" inputmode="tel" pattern="^09\d{9}$" placeholder="مثلاً 09121234567" required />
            <div class="error" data-for="phone">شماره باید با 09 شروع و 11 رقم باشد.</div>
          </div>
          <div>
            <label class="required" for="amount">مبلغ وام (تومان)</label>
            <input id="amount" name="amount" inputmode="numeric" placeholder="مثلاً 200000000" required />
            <div class="error" data-for="amount">مبلغ معتبر وارد کنید.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label class="required" for="term">مدت بازپرداخت</label>
            <select id="term" name="term" required>
              <option value="" selected disabled>انتخاب کنید…</option>
              <option value="12">۱۲ ماه</option>
              <option value="24">۲۴ ماه</option>
              <option value="36">۳۶ ماه</option>
              <option value="48">۴۸ ماه</option>
            </select>
            <div class="error" data-for="term">مدت را انتخاب کنید.</div>
          </div>
          <div>
            <label for="purpose">هدف از وام</label>
            <select id="purpose" name="purpose">
              <option value="" selected>انتخاب کنید…</option>
              <option>مسکن</option>
              <option>کسب‌وکار</option>
              <option>تحصیل</option>
              <option>خرید کالا</option>
              <option>سایر</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label class="required" for="income">درآمد ماهانه (تومان)</label>
            <input id="income" name="income" inputmode="numeric" required />
            <div class="error" data-for="income">درآمد معتبر وارد کنید.</div>
          </div>
          <div>
            <label for="employment">وضعیت شغلی</label>
            <select id="employment" name="employment">
              <option value="" selected>انتخاب کنید…</option>
              <option>کارمند</option>
              <option>آزاد</option>
              <option>بازنشسته</option>
              <option>دانشجو</option>
              <option>بیکار</option>
            </select>
          </div>
        </div>

        <div>
          <label for="notes">توضیحات</label>
          <textarea id="notes" name="notes" rows="3" placeholder="توضیحات تکمیلی…"></textarea>
        </div>

        <div class="divider"></div>

        <div class="actions">
          <button type="submit">ارسال درخواست</button>
          <button type="button" class="ghost" id="saveDraft">ذخیره پیش‌نویس</button>
          <button type="reset" class="ghost">پاک کردن</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // عددی کردن ساده فیلدهای پولی
    const numericIds = ["amount","income"];
    numericIds.forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener("input", ()=>{
        // فقط رقم
        const digits = el.value.replace(/[^\d]/g,"");
        el.value = digits;
      });
    });

    function showError(id, show=true){
      const el = document.querySelector(`.error[data-for="${id}"]`);
      if(!el) return;
      el.style.display = show ? "block" : "none";
    }

    function toast(msg, ok=false){
      const t = document.getElementById("toast");
      t.className = "toast" + (ok ? " ok": "");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> t.style.display="none", 3500);
    }

    // بارگذاری و ذخیره پیش‌نویس در localStorage
    (function loadDraft(){
      const draft = localStorage.getItem("loanDraft");
      if(!draft) return;
      try{
        const data = JSON.parse(draft);
        Object.keys(data).forEach(k=>{
          const el = document.querySelector(`[name="${k}"]`);
          if(el) el.value = data[k];
        });
      }catch(e){}
    })();

    document.getElementById("saveDraft").addEventListener("click", ()=>{
      const form = new FormData(document.getElementById("loanForm"));
      const data = {};
      form.forEach((v,k)=> data[k]=v);
      localStorage.setItem("loanDraft", JSON.stringify(data));
      toast("پیش‌نویس ذخیره شد.", true);
    });

    // اعتبارسنجی و ارسال ساختگی
    document.getElementById("loanForm").addEventListener("submit", (e)=>{
      e.preventDefault();
      let ok = true;

      const checks = [
        {id:"fullName", valid: v=> v.trim().length>1},
        {id:"nid", valid: v=> /^\d{10}$/.test(v)},
        {id:"phone", valid: v=> /^09\d{9}$/.test(v)},
        {id:"amount", valid: v=> /^\d{5,}$/.test(v)}, // حداقل ۵ رقم
        {id:"income", valid: v=> /^\d{5,}$/.test(v)},
        {id:"term", valid: v=> !!v}
      ];

      checks.forEach(({id,valid})=>{
        const val = document.getElementById(id).value;
        const isValid = valid(val);
        showError(id, !isValid);
        if(!isValid) ok=false;
      });

      if(!ok){ toast("لطفاً خطاهای فرم را برطرف کنید."); return; }

      // شبیه‌سازی ارسال
      const payload = Object.fromEntries(new FormData(e.target).entries());
      console.log("SUBMIT", payload); // برای تست
      localStorage.removeItem("loanDraft");
      toast("درخواست شما با موفقیت ثبت شد ✅", true);

      // در پروژه واقعی اینجا fetch بزنید:
      // fetch('/api/loan', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)})
    });

    // اگر کاربر دارک‌مود سیستم را اجباری کرده بود و مرورگر «تحمیلِ تم تیره» انجام می‌دهد،
    // باز هم به‌خاطر رنگ‌های تعریف‌شده خوانایی حفظ می‌شود.
  </script>
</body>
</html>